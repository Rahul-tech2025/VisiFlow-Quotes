<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VisiFlow Quotes â€“ Galaxy Ultra</title>
  <link rel="stylesheet" href="output.css" />

  <!-- Save as Image Library -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<body class="relative min-h-screen overflow-hidden bg-black text-white">
  <div class="shooting-star"></div>

  <!-- ðŸš€ LOADING SCREEN -->
  <div id="loadingScreen"
    class="fixed inset-0 flex justify-center items-center bg-black z-50">
    <div class="warp-circle"></div>
    <h2 class="text-white text-3xl font-bold mt-6 animate-pulse">
      Entering VisiFlow Galaxy...
    </h2>
  </div>

  <!-- ðŸ”„ THEME SWITCH -->
  <button id="themeBtn"
    class="fixed top-6 left-6 z-50 px-4 py-2 bg-white/20 backdrop-blur-xl rounded-xl shadow-lg 
    hover:bg-white/30 transition">
    ðŸ”„ Theme
  </button>

  <!-- ðŸŒ™ DARK MODE -->
  <button id="toggleMode"
    class="fixed top-6 right-6 z-50 px-4 py-2 bg-white/20 backdrop-blur-xl rounded-xl shadow-lg 
    hover:bg-white/30 transition">
    ðŸŒ™ Mode
  </button>

  <!-- ðŸŽµ MUSIC TOGGLE -->
  <button id="musicBtn"
    class="fixed top-20 right-6 z-50 px-4 py-2 bg-white/20 backdrop-blur-xl rounded-xl shadow-lg 
    hover:bg-white/30 transition">
    ðŸŽµ Music
  </button>

  <!-- CLICK + MUSIC AUDIO -->
  <audio id="clickSound" src="assets/sfx/soft-click.mp3" preload="auto"></audio>
  <audio id="bgMusic" src="assets/music/lofi-space-bg.mp3" preload="auto" loop></audio>

  <!-- â­ STARFIELD -->
  <div id="stars" class="absolute inset-0 animate-stars opacity-40"></div>

  <!-- ðŸŒŒ AURORA -->
  <div id="aurora"
    class="absolute inset-0 bg-[url('https://raw.githubusercontent.com/rajatdiptabiswas/AssetsCDN/main/aurora/aurora2.png')]
    bg-cover mix-blend-screen opacity-30 animate-aurora"></div>

  <!-- RANDOM METEORS -->
  <div id="dynamicMeteors"></div>

  <!-- CONSTANT METEORS -->
  <div class="meteor"></div>
  <div class="meteor"></div>
  <div class="meteor"></div>

  <!-- ðŸŒ€ NEBULA -->
  <div id="nebula" class="absolute inset-0 bg-[radial-gradient(circle_at_center,#4b1fa777,#000)] animate-swirl"></div>

  <!-- ðŸª ORBIT RINGS -->
  <div class="planet-orbit orbit1"></div>
  <div class="planet-orbit orbit2"></div>

  <!-- FLOATING PLANETS -->
  <img src="https://raw.githubusercontent.com/rajatdiptabiswas/AssetsCDN/main/planets/planet1.png"
       class="planet planet1" />
  <img src="https://raw.githubusercontent.com/rajatdiptabiswas/AssetsCDN/main/planets/planet2.png"
       class="planet planet2" />

  <!-- PARALLAX LAYER -->
  <div id="parallax" class="absolute inset-0"></div>

  <!-- MAIN CARD -->
  <div class="relative z-20 w-full max-w-md mx-auto mt-[15vh]
      backdrop-blur-2xl bg-white/10 border border-white/20
      rounded-3xl shadow-[0_0_55px_#a855f788] 
      p-8 text-center animate-fadeIn cardFloat">

    <!-- LOGO -->
    <img src="logo.svg" class="w-48 mx-auto mb-6 animate-logo"/>

    <!-- Mood Dropdown -->
    <select id="mood"
      class="w-full p-3 rounded-xl bg-white/10 text-white border border-white/20 
      focus:border-purple-400 backdrop-blur-xl mb-4">
      <option value="happy" class="text-black">Happy</option>
      <option value="sad" class="text-black">Sad</option>
      <option value="motivational" class="text-black">Motivational</option>
    </select>

    <!-- Generate Button -->
    <button onclick="getQuote()" 
      class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 
      rounded-xl shadow-[0_0_30px_#8b5cf6] hover:shadow-[0_0_55px_#a855f7]
      hover:scale-105 active:scale-95 transition-all duration-300 font-semibold">
      Generate Quote
    </button>

    <!-- QUOTE -->
    <p id="quoteDisplay"
      class="mt-6 text-xl font-bold opacity-0 transition duration-500 drop-shadow-[0_0_12px_#a855f7aa]"></p>

    <!-- SHARE & SAVE -->
    <button id="shareBtn"
      class="mt-4 px-4 py-2 bg-white/10 border border-white/20 rounded-xl hover:bg-white/20 backdrop-blur-lg">
      ðŸ“¤ Share Quote
    </button>

    <button id="saveBtn"
      class="mt-2 px-4 py-2 bg-white/10 border border-white/20 rounded-xl hover:bg-white/20 backdrop-blur-lg">
      ðŸ’¾ Save as Image
    </button>
  </div>

  <script src="quotes.js"></script>

  <script>
    // Typewriter
    function typeText(element, text) {
      element.innerHTML = "";
      let i = 0;
      let interval = setInterval(() => {
        element.innerHTML += text.charAt(i);
        i++;
        if (i === text.length) clearInterval(interval);
      }, 30);
    }

    // Fetch Quote + CLICK SOUND
    function getQuote() {
      const mood = document.getElementById("mood").value;
      fetch(`http://localhost:5000/quotes/${mood}`)
        .then(res => res.json())
        .then(data => {
          clickSound.currentTime = 0;
          clickSound.play();

          const quoteBox = document.getElementById("quoteDisplay");
          quoteBox.style.opacity = 0;

          setTimeout(() => {
            typeText(quoteBox, data.quote);
            quoteBox.style.opacity = 1;
          }, 200);
        });
    }

    // Parallax PC
    document.addEventListener("mousemove", (e) => {
      const x = (e.clientX / window.innerWidth - 0.5) * 20;
      const y = (e.clientY / window.innerHeight - 0.5) * 20;
      document.getElementById("parallax").style.transform = `translate(${x}px, ${y}px)`;
    });

    // Parallax Mobile
    document.addEventListener("touchmove", (e) => {
      const x = (e.touches[0].clientX / window.innerWidth - 0.5) * 20;
      const y = (e.touches[0].clientY / window.innerHeight - 0.5) * 20;
      document.getElementById("parallax").style.transform = `translate(${x}px, ${y}px)`;
    });

    // Cursor Trail
    document.addEventListener("mousemove", (e) => {
      let dot = document.createElement("div");
      dot.className = "cursor-dot";
      dot.style.left = e.pageX + "px";
      dot.style.top = e.pageY + "px";
      document.body.appendChild(dot);
      setTimeout(() => dot.remove(), 500);
    });

    // Dark Mode
    document.getElementById("toggleMode").onclick = () =>
      document.body.classList.toggle("light");


    /* â­ MUSIC CONTROL FIXED */
    const musicBtn = document.getElementById("musicBtn");
    let musicOn = false;

    musicBtn.addEventListener("click", () => {
      if (!musicOn) {
        bgMusic.volume = 0;
        bgMusic.play();

        let fade = setInterval(() => {
          if (bgMusic.volume < 0.3) {
            bgMusic.volume += 0.02;
          } else clearInterval(fade);
        }, 120);

        musicBtn.innerText = "ðŸ”ˆ Music On";
        musicOn = true;

      } else {
        bgMusic.pause();
        musicBtn.innerText = "ðŸŽµ Music";
        musicOn = false;
      }
    });

    /* â­ MOBILE AUDIO UNLOCK */
    document.addEventListener("DOMContentLoaded", () => {
      const unlock = () => {
        clickSound.play().then(() => {
          clickSound.pause();
          clickSound.currentTime = 0;
        });

        bgMusic.play().then(() => {
          bgMusic.pause();
          bgMusic.currentTime = 0;
        });

        document.body.removeEventListener("click", unlock);
      };
      document.body.addEventListener("click", unlock);
    });

    // Theme Randomizer
    const themes = ["#4b1fa7", "#ff0066", "#0080ff", "#00ffaa"];
    document.getElementById("themeBtn").onclick = () => {
      let color = themes[Math.floor(Math.random() * themes.length)];
      document.getElementById("nebula").style.background =
        `radial-gradient(circle at center, ${color}77, #000)`;
    };

    // Meteor Generator
    setInterval(() => {
      let meteor = document.createElement("div");
      meteor.className = "meteor";
      document.getElementById("dynamicMeteors").appendChild(meteor);
      setTimeout(() => meteor.remove(), 3000);
    }, 2000);

    // Save as Image
    document.getElementById("saveBtn").onclick = () => {
      html2canvas(document.querySelector(".cardFloat")).then(canvas => {
        let link = document.createElement("a");
        link.download = "VisiFlow-quote.png";
        link.href = canvas.toDataURL();
        link.click();
      });
    };

    // Share Quote
    document.getElementById("shareBtn").onclick = () => {
      const quote = document.getElementById("quoteDisplay").innerText;
      const url = `https://wa.me/?text=${encodeURIComponent(quote)}`;
      window.open(url, "_blank");
    };

    // Loading Remove
    setTimeout(() => {
      document.getElementById("loadingScreen").style.opacity = "0";
      setTimeout(() => {
        document.getElementById("loadingScreen").remove();
      }, 800);
    }, 2500);
  </script>
</body>
</html>
